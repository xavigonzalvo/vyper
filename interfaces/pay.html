<div id="status"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/ethereumjs/browser-builds/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.min.js"></script>
<script>

  const ethEnabled = () => {
    // if (window.ethereum) {
    //   await window.ethereum.send('eth_requestAccounts');
    //   window.web3 = new Web3(window.ethereum);
    //   return true;
    // }
    console.log('No metamask');
    return false;
  }

  $(document).ready(function() {
    if (!ethEnabled()) {
      console.log('Connecting to infura');
      try {
        const rpcURL = 'https://rinkeby.infura.io/v3/49775e1c3d3a4851b61602c4af9c56d6'
        window.web3 = new Web3(rpcURL)
      } catch (error) {
        alert(error)
      }
    }
    getValue();
    pay();
  })

  const abi = [{"name": "DataChange", "inputs": [{"name": "setter", "type": "address", "indexed": true}, {"name": "value", "type": "uint256", "indexed": false}], "anonymous": false, "type": "event"}, {"stateMutability": "nonpayable", "type": "constructor", "inputs": [{"name": "_x", "type": "uint256"}], "outputs": []}, {"stateMutability": "nonpayable", "type": "function", "name": "set", "inputs": [{"name": "new_value", "type": "uint256"}], "outputs": [], "gas": 37090}, {"stateMutability": "view", "type": "function", "name": "get", "inputs": [{"name": "user", "type": "address"}], "outputs": [{"name": "", "type": "uint256"}], "gas": 2633}, {"stateMutability": "payable", "type": "function", "name": "pay", "inputs": [{"name": "user", "type": "address"}], "outputs": [], "gas": 36611}, {"stateMutability": "view", "type": "function", "name": "stored_data", "inputs": [{"name": "arg0", "type": "address"}], "outputs": [{"name": "", "type": "uint256"}], "gas": 2693}]
  const contactAddress = '0xbee4d28057596cfb1c381f2ebbb8eb5143c36159'
  async function getValue() {
    console.log('GetValue')
    const contract = new window.web3.eth.Contract(abi, contactAddress);
    contract.methods.get('0x7e583bf0284c1830ff38a3b18c2eca497d34b687').call((err, result) => {
      console.log(result) })
  }

  async function pay() {
    const contract = new window.web3.eth.Contract(abi, contactAddress);
    contract.methods.pay('0x09d94aF784e2b033B0B5D9425C7767649adEE820').call((err, result) => {
      console.log(result) })
  }
  </script>
